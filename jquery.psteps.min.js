/*
 * jQuery Pines Steps (psteps) Plugin 0.0.1alpha
 *
 * http://pinesframework.org/psteps/
 * Copyright (c) 2012 Angela Murrell
 *
 * Triple license under the GPL, LGPL, and MPL:
 *	  http://www.gnu.org/licenses/gpl.html
 *	  http://www.gnu.org/licenses/lgpl.html
 *	  http://www.mozilla.org/MPL/MPL-1.1.html
 */
(function(d){d.fn.psteps=function(n){var c=d.extend({},d.fn.psteps.defaults,n);this.each(function(){var a=d(this);a.psteps_version="0.0.1alpha";if(a.hasClass("steps-transformed"))return true;a.addClass("steps-transformed");a.opts=c;var h=a.find(".step-content"),o=a.find(".step-title"),n=a.find(".step-name"),j=a.find(".next-button"),g=a.find(".back-button"),i=a.find(".submit-button"),k=a.find(".next-button, .submit-button"),p=a.find(".step-title").length,l=true;a.get_max_height=function(a){var c=-1;
a.each(function(){var a=d(this).height();c=a>c?a:c});return c};c.step_order||a.find(".step-order").hide();a.make_step_content_headings=function(){a.find(".step-title").each(function(b){var f=d(this).find(".step-name"),b=a.find(".step-content").eq(b);if(f.length==1){var e=c.content_headings_hr?"<hr/>":"",f='<div class="step-content-name"><'+c.content_headings_element+">"+f.html()+"</"+c.content_headings_element+">"+e+"</div>";c.content_headings_after!=false&&b.find(c.content_headings_after).length>
0?b.find(c.content_headings_after).after(f):b.prepend(f)}})};if(c.content_height_equalize||c.steps_height_equalize||c.steps_width_percentage||c.shrink_step_names){if(c.steps_height_equalize)var m=a.find(".step-title"),r=a.get_max_height(m);if(c.content_height_equalize){m=a.find(".step-content");m.addClass("clearfix");var s=a.get_max_height(m)}d(window).resize(function(){if(c.steps_width_percentage){var b=100/p-1;d(window).width()<parseInt(c.alter_width_at_viewport)&&a.find(".step-title").css({width:b+
"%","padding-left":"0","padding-right":"0"})}c.shrink_step_names&&(d(window).width()<=parseInt(c.alter_names_at_viewport)?setTimeout(function(){a.find(".step-content-name").remove();a.find(".step-name").hide();a.find(".step-order").show();a.make_step_content_headings()},200):setTimeout(function(){a.find(".step-content-name").remove();c.step_order||a.find(".step-order").hide();c.step_names&&a.find(".step-name").show();c.content_headings&&a.make_step_content_headings()},200));c.steps_height_equalize&&
(b=a.find(".step-title"),b.css("min-height",r),b.css("min-height",a.get_max_height(b)));c.content_height_equalize&&setTimeout(function(){var b=a.find(".step-content");b.css("min-height",s);b.css("min-height",a.get_max_height(b))},2E3)}).resize()}a.check_progress_titles=function(){a.find(".step-content").each(function(b){var f=d(this),e="pstep"+(b+1);f.addClass(e);b=a.find(".step-title").eq(b);b.addClass(e);if(c.traverse_titles=="visited"&&b.hasClass("step-visited")||c.traverse_titles=="never"&&b.hasClass("step-visited")||
c.traverse_titles=="always")e=c.validation_rule.call(f),e=="warning"?(b.removeClass("step-error btn-info btn-success btn-warning btn-danger").addClass("step-warning"),a.trigger_error(f)):e=="error"?(b.removeClass("step-warning btn-info btn-success btn-warning btn-danger").addClass("step-error"),a.trigger_error(f)):e?(b.removeClass("step-warning btn-info btn-warning btn-danger step-error").addClass("btn-success"),c.check_marks&&b.find("i.step-mark").remove().end().prepend('<i class="icon-ok step-mark"></i> ')):
e||b.removeClass("step-warning btn-info btn-success btn-danger btn-warning step-error").addClass("btn-info").find("i.step-mark").remove()});a.toggle_buttons_function();a.trigger("validation_complete.psteps")};a.toggle_buttons_function=function(){var b=j.attr("data-btn-name"),f=i.attr("data-btn-name"),e=g.attr("data-btn-name");b!=void 0&&b.length&&j.html(b);f!=void 0&&f.length&&i.html(f);e!=void 0&&e.length&&g.html(e);a.find(".step-content").last().hasClass("step-active")?(j.hasClass("btn-manual")||
j.hide(),i.hasClass("btn-manual")||i.show()):(j.hasClass("btn-manual")||j.show(),i.hasClass("btn-manual")||i.hide());b=a.find(".step-title.step-active");b.hasClass("btn-success")||b.hasClass("step-warning")?k.removeClass("btn-info").addClass("btn-success"):b.hasClass("btn-info")?k.removeClass("btn-success").addClass("btn-info"):b.hasClass("step-error")&&k.removeClass("btn-success btn-info").addClass("btn-danger");c.validate_submit_all_steps&&(o.filter(".btn-info").length||o.filter(".step-error").length&&
!c.ignore_errors_on_submit)&&i.removeClass("btn-success").addClass("btn-info");c.back?a.find(".step-title").first().hasClass("step-active")?g.hide():(b=a.find(".step-title.step-active").prevAll(".step-title:first"),b.hasClass("btn-info")?g.removeClass("btn-success btn-warning btn-danger").addClass("btn-info").css("cursor","pointer"):b.hasClass("btn-success")?g.removeClass("btn-info btn-warning btn-danger").addClass("btn-success").css("cursor","pointer"):b.hasClass("btn-warning")?g.removeClass("btn-info btn-success btn-danger").addClass("btn-warning").css("cursor",
"pointer"):b.hasClass("btn-danger")&&g.removeClass("btn-success btn-warning btn-info").addClass("btn-danger").css("cursor","pointer"),g.show()):g.hide()};a.go_to_step=function(b){var f=a.find(".step-title.last-active"),e=a.find(".step-content.last-active"),d=a.find(".step-content.step-active"),g=a.find(".step-title.step-active");if(!(b>p)){var h=a.find(".step-content").eq(b-1),b=a.find(".step-title").eq(b-1);a.find(".step-resume").length&&a.find(".step-transition-processing").removeClass("step-transition-processing");
g.hasClass("step-transition")&&!a.find(".step-resume").length&&!l&&c.steps_transition.call(d);g.hasClass("step-transition-processing")?(a.find(".step-resume").removeClass("step-resume"),b.addClass("step-resume")):(a.find(".step-resume").removeClass("step-resume"),l||c.steps_hide.call(d),f.removeClass("last-active"),e.removeClass("last-active"),d.hide().removeClass("step-active").addClass("last-active"),h.show().addClass("step-active step-visited"),g.removeClass("step-active").addClass("disabled last-active"),
b.addClass("step-active step-visited").removeClass("disabled"),h.hasClass("step-loaded")||c.steps_onload.call(h),h.addClass("step-loaded"),c.steps_show.call(h),c.traverse_titles=="visited"&&g.css("cursor","pointer"),l?l=false:a.trigger("validate.psteps"),a.toggle_buttons_function())}};a.go_to_next_step=function(){var b=a.find(".step-title.step-active").prevAll(".step-title");a.go_to_step(b.length+2)};a.go_to_prev_step=function(){var b=a.find(".step-title.step-active").prevAll(".step-title");a.go_to_step(b.length)};
a.change_traverse=function(b){var c=a.find(".step-title");a.off("click",".step-title:not(.step-notraverse)");a.off("click",".step-title.step-active:not(.step-notraverse)");a.off("click",".step-title.step-visited:not(.step-notraverse)");b=="always"?(c.css("cursor","pointer"),a.on("click",".step-title:not(.step-notraverse)",function(){var b=d(this).prevAll(".step-title");a.go_to_step(b.length+1)}).css("cursor","pointer")):b=="visited"?(c.css("cursor","default").filter(".step-visited").css("cursor",
"pointer"),a.on("click",".step-title.step-visited:not(.step-notraverse)",function(){var b=d(this);b.prevAll(".step-title:first").hasClass("step-active")?a.go_to_next_step():b.nextAll(".step-title:first").hasClass("step-active")?a.go_to_prev_step():(b=b.prevAll(".step-title"),a.go_to_step(b.length+1))})):b=="never"&&(c.css("cursor","default"),a.on("click",".step-title.step-active:not(.step-notraverse)",function(){var b=d(this).prevAll(".step-title");a.go_to_step(b.length+1)}));c.filter(".step-notraverse").css("cursor",
"default")};a.trigger_error=function(b){b=b.prevAll(".step-content").length+1;b=a.find(".step-title").eq(b-1);b.hasClass("step-warning")?(b.removeClass("btn-info btn-success").addClass("btn-warning"),c.check_marks&&b.find("i.step-mark").remove().end().prepend('<i class="icon-remove step-mark"></i> ')):b.hasClass("step-error")&&(b.removeClass("btn-info btn-success").addClass("btn-danger"),c.check_marks&&b.find("i.step-mark").remove().end().prepend('<i class="icon-remove step-mark"></i> '))};h.hide().first().addClass("step-visited step-active").show();
o.addClass("disabled btn").first().addClass("step-visited step-active").removeClass("disabled");c.step_names||n.hide();a.change_traverse(c.traverse_titles);a.check_progress_titles();c.content_headings&&a.make_step_content_headings();c.start_incomplete_step?(h=a.find(".step-title.btn-info").first(),a.go_to_step(h.prevAll(".step-title").length+1)):c.start_warning_step?(h=a.find(".step-title.step-warning").first(),a.go_to_step(h.prevAll(".step-title").length+1)):c.start_error_step?(h=a.find(".step-title.step-error").first(),
a.go_to_step(h.prevAll(".step-title").length+1)):a.go_to_step(c.step_start);g.click(function(){a.go_to_prev_step()});var q=0;a.bind("validate.psteps",function(b){b.timeStamp<q+500?(b.preventDefault(),b.stopPropagation()):(q=b.timeStamp,a.check_progress_titles())});a.bind("traverse_never.psteps",function(){a.change_traverse("never")});a.bind("traverse_always.psteps",function(){a.change_traverse("always")});a.bind("traverse_visited.psteps",function(){a.change_traverse("visited")});a.bind("load_after_steps.psteps",
function(){c.load_after_steps.call(a)});a.on("step_error.psteps",".step-content",function(){a.trigger_error(d(this))});a.on("go_to_step.psteps",".step-title",function(){var b=d(this).prevAll(".step-title");a.go_to_step(b.length+1)});a.bind("go_to_first_incomplete.psteps",function(){var b=a.find(".step-title.btn-info:first").prevAll(".step-title");a.go_to_step(b.length+1)});a.bind("go_to_first_warning.psteps",function(){var b=a.find(".step-title.step-warning:first").prevAll(".step-title");a.go_to_step(b.length+
1)});a.bind("go_to_first_error.psteps",function(){var b=a.find(".step-title.step-error:first").prevAll(".step-title");a.go_to_step(b.length+1)});k.click(function(b){var f=d(this);a.trigger("validate.psteps");var e=a.find(".step-title.step-active");e.hasClass("step-error")&&c.validate_errors&&!c.validate_next_step?c.validate_use_error_msg?alert(c.validate_error_msg):e.click():e.hasClass("step-error")&&c.validate_next_step&&!c.ignore_errors_on_next?d.noop():e.hasClass("step-error")&&c.ignore_errors_on_next?
a.go_to_next_step():f.hasClass("btn-success")?a.go_to_next_step():f.hasClass("submit-button")&&(c.validate_submit_all_steps||c.validate_next_step)?(c.use_before_submit&&alert(c.before_submit),b.preventDefault()):c.validate_next_step&&c.use_before_next?alert(c.before_next):a.go_to_next_step()});this.pines_steps=a});return this};d.fn.psteps.defaults={traverse_titles:"never",content_headings:false,content_headings_element:"h4",content_headings_hr:true,content_headings_after:false,step_order:true,step_names:true,
check_marks:true,alter_width_at_viewport:"1000",steps_width_percentage:false,steps_height_equalize:false,content_height_equalize:false,alter_names_at_viewport:"650",shrink_step_names:true,back:true,step_start:"1",steps_onload:function(){},steps_show:function(){},steps_hide:function(){},steps_transition:function(){},start_incomplete_step:false,start_warning_step:false,start_error_step:false,validation_rule:function(){return true},validate_next_step:true,validate_submit_all_steps:true,validate_errors:true,
ignore_errors_on_next:false,ignore_errors_on_submit:false,validate_error_msg:"There was an error processing the step.",validate_use_error_msg:true,use_before_submit:true,before_submit:"Please complete all of the required steps before submitting.",use_before_next:true,before_next:"Please complete this step before advancing to the next step.",load_after_steps:function(){}}})(jQuery);
